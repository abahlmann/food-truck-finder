//the following are our location objects: they hold food truck 
//and weather information for each clickable location
var backBayBoston = {
  name: "Back Bay",
  city: "Boston",
  weather: {
    description: "",
    icon: "",
    temperature: 0,
    humidity: "",
    tempMax: "",
    tempMin: ""
  },
  yCoordinate: 42.3053,
  xCoordinate: -71.081,
  foodTruckNames: [],
  foodTruckLocations: [],
  foodTruckHours: [],
  foodTruckLink: [],
  foodTruckPinpoint: [],
  foodTruckDays:[],

  resetLocation: function(){
    this.weather.description= "";
    this.weather.icon= "";
    this.weather.temperature= 0;
    this.weather.humidity= "";
    this.weather.tempMax= "";
    this.weather.tempMin= "";
    this.foodTruckNames= [];
    this.foodTruckLocations= [];
    this.foodTruckHours= [];
    this.foodTruckLink= [];
    this.foodTruckPinpoint= [];
    this.foodTruckDays=[];
    }
};

var aquariumBoston = {
  name: "The New England Aquarium",
  city: "Boston",
  weather: {
    description: "",
    icon: "",
    temperature: 0,
    humidity: "",
    tempMax: "",
    tempMin: ""
  },
  yCoordinate: 42.3592,
  xCoordinate: -71.0491,
  foodTruckNames: [],
  foodTruckLocations: [],
  foodTruckHours: [],
  foodTruckLink: [],
  foodTruckPinpoint: [],
  foodTruckDays:[],

  resetLocation: function(){
    this.weather.description= "";
    this.weather.icon= "";
    this.weather.temperature= 0;
    this.weather.humidity= "";
    this.weather.tempMax= "";
    this.weather.tempMin= "";
    this.foodTruckNames= [];
    this.foodTruckLocations= [];
    this.foodTruckHours= [];
    this.foodTruckLink= [];
    this.foodTruckPinpoint= [];
    this.foodTruckDays=[];
    }
};

var kenmoreBoston = {
  name: "Kenmore Square",
  city: "Boston",
  weather: {
    description: "",
    icon: "",
    temperature: 0,
    humidity: "",
    tempMax: "",
    tempMin: ""
  },
  yCoordinate: 42.3429,
  xCoordinate: -71.1003,
  foodTruckNames: [],
  foodTruckLocations: [],
  foodTruckHours: [],
  foodTruckLink: [],
  foodTruckPinpoint: [],
  foodTruckDays:[],

  resetLocation: function(){
    this.weather.description= "";
    this.weather.icon= "";
    this.weather.temperature= 0;
    this.weather.humidity= "";
    this.weather.tempMax= "";
    this.weather.tempMin= "";
    this.foodTruckNames= [];
    this.foodTruckLocations= [];
    this.foodTruckHours= [];
    this.foodTruckLink= [];
    this.foodTruckPinpoint= [];
    this.foodTruckDays=[];
    }
};

var eastBoston = {
  name: "East Boston",
  city: "Boston",
  weather: {
    description: "",
    icon: "",
    temperature: 0,
    humidity: "",
    tempMax: "",
    tempMin: ""
  },
  yCoordinate: 42.37021,
  xCoordinate: -71.03886,
  foodTruckNames: [],
  foodTruckLocations: [],
  foodTruckHours: [],
  foodTruckLink: [],
  foodTruckPinpoint: [],
  foodTruckDays:[],

  resetLocation: function(){
    this.weather.description= "";
    this.weather.icon= "";
    this.weather.temperature= 0;
    this.weather.humidity= "";
    this.weather.tempMax= "";
    this.weather.tempMin= "";
    this.foodTruckNames= [];
    this.foodTruckLocations= [];
    this.foodTruckHours= [];
    this.foodTruckLink= [];
    this.foodTruckPinpoint= [];
    this.foodTruckDays=[];
    }
};

var southStationBoston = {
  name: "South Station",
  city: "Boston",
  weather: {
    description: "",
    icon: "",
    temperature: 0,
    humidity: "",
    tempMax: "",
    tempMin: ""
  },
  yCoordinate: 42.3519,
  xCoordinate: -71.0551,
  foodTruckNames: [],
  foodTruckLocations: [],
  foodTruckHours: [],
  foodTruckLink: [],
  foodTruckPinpoint: [],
  foodTruckDays:[],

  resetLocation: function(){
    this.weather.description= "";
    this.weather.icon= "";
    this.weather.temperature= 0;
    this.weather.humidity= "";
    this.weather.tempMax= "";
    this.weather.tempMin= "";
    this.foodTruckNames= [];
    this.foodTruckLocations= [];
    this.foodTruckHours= [];
    this.foodTruckLink= [];
    this.foodTruckPinpoint= [];
    this.foodTruckDays=[];
    }
};

var copleyBoston = {
  name: "Copley Square",
  city: "Boston",
  weather: {
    description: "",
    icon: "",
    temperature: 0,
    humidity: "",
    tempMax: "",
    tempMin: ""
  },
  yCoordinate: 42.3432,
  xCoordinate: -71.0726,
  foodTruckNames: [],
  foodTruckLocations: [],
  foodTruckHours: [],
  foodTruckLink: [],
  foodTruckPinpoint: [],
  foodTruckDays:[],

  resetLocation: function(){
    this.weather.description= "";
    this.weather.icon= "";
    this.weather.temperature= 0;
    this.weather.humidity= "";
    this.weather.tempMax= "";
    this.weather.tempMin= "";
    this.foodTruckNames= [];
    this.foodTruckLocations= [];
    this.foodTruckHours= [];
    this.foodTruckLink= [];
    this.foodTruckPinpoint= [];
    this.foodTruckDays=[];
    }
};

var northeasternBoston = {
  name: "Northeastern University",
  city: "Boston",
  weather: {
    description: "",
    icon: "",
    temperature: 0,
    humidity: "",
    tempMax: "",
    tempMin: ""
  },
  yCoordinate: 42.3601,
  xCoordinate: -71.0589,
  foodTruckNames: [],
  foodTruckLocations: [],
  foodTruckHours: [],
  foodTruckLink: [],
  foodTruckPinpoint: [],
  foodTruckDays:[],

  resetLocation: function(){
    this.weather.description= "";
    this.weather.icon= "";
    this.weather.temperature= 0;
    this.weather.humidity= "";
    this.weather.tempMax= "";
    this.weather.tempMin= "";
    this.foodTruckNames= [];
    this.foodTruckLocations= [];
    this.foodTruckHours= [];
    this.foodTruckLink= [];
    this.foodTruckPinpoint= [];
    this.foodTruckDays=[];
    }
};

//here we define global variables for our findFoodTrucks() function
var records;
var maxX, maxY, minX, minY;
//here we define our findFoodTrucks() function. 
//It finds the food trucks within a designated distance from the specified location
function findFoodTrucks(location) {
  $.ajax({
    url:
      "https://data.boston.gov/api/3/action/datastore_search?resource_id=9960513f-1a7f-4f02-847c-553e7c8a60f7",
    dataType: "jsonp",
    cache: true,
    method: "GET"
  }).then(function(response) {
    //shorthand
    records = response.result.records;

    //specified coordinate box
    maxX = parseFloat(location.xCoordinate) + 0.005;
    minX = parseFloat(location.xCoordinate) - 0.005;
    maxY = parseFloat(location.yCoordinate) + 0.005;
    minY = parseFloat(location.yCoordinate) - 0.005;

    //searching API for food trucks in coordinate box
    for (var i = 0; i < records.length; i++) {
      if (
        (records[i].x <= maxX && records[i].x >= minX) &&
        (records[i].y <= maxY && records[i].y >= minY) &&
        (location.foodTruckNames.indexOf(records[i].Truck)<0)
      ) {
        location.foodTruckLocations.push(records[i].Location);
        location.foodTruckNames.push(records[i].Truck);
        if(location.foodTruckHours.indexOf(records[i].Hours)<0){
        location.foodTruckHours.push(records[i].Hours);
        }
        location.foodTruckDays.push(records[i].Day);
        location.foodTruckLink.push(records[i].Link);
        location.foodTruckPinpoint.push(records[i].Pinpoint);
      }
    }

      //here we are displaying the food trucks in the location
  //when there are none, the program apologizes that there are none
  if (location.foodTruckNames.length===0){
    $("#food-trucks").append("<div> <h5>Sorry.. There are no trucks here right now!</h5> </div>");
  }
  else {
    console.log(location.foodTruckNames.length);
  for (var i=0;i<location.foodTruckNames.length;i++){
  $("#food-trucks").append("<a href='"+location.foodTruckLink[i]+"'><div id='food-truck-card'><h3>"+location.foodTruckNames[i]+"</h3><p>"+location.foodTruckPinpoint[i]+", "+location.foodTruckLocations[i]+"</p><p>"+location.foodTruckDays[i]+": "+location.foodTruckHours+"</p></div></a>");
  }
  }
  });
}

//global variable for findWeather()
var weather;
//here we're defining the findWeather() function
//it finds the weather based on the city the location resides in
//would definitely be more profound if we used locations outside of boston
function findWeather(location) {
  //shorthand
  weather = location.weather;
  $.ajax({
    url:
      "https://api.openweathermap.org/data/2.5/weather?q="+location.city+"&appid=74694f219dec1ad3f001b89fcece53c7",
    dataType: "jsonp",
    cache: true,
    method: "GET"
  }).then(function(response) {
    //copying values into OUR object
    weather.description = response.weather[0].main+", "+response.weather[0].description;
    weather.temperature = response.main.temp;
    weather.humidity = response.main.humidity;
    weather.tempMin = response.main.temp_min;
    weather.tempMax = response.main.temp_max;
    
      //here we are displaying the weather in the location's city
  $("#weather").append("<h2>"+parseInt(((weather.temperature)-273.15)*9/5 + 32)+"°F"+"</h2>");
  $("#weather").append("<p>"+weather.description+"</p>");
  $("#weather").append("<p>"+weather.humidity+"% Humidity</p>");
  $("#weather").append("<h3> Min: "+parseInt(((weather.tempMin)-273.15)*9/5 + 32)+"°F"+"</h3>");
  $("#weather").append("<h3> Max: "+parseInt(((weather.tempMax)-273.15)*9/5 + 32)+"°F"+"</h3>");
  });
}

function reset(){
$("#display-screen").hide();
$("#search-screen").show();
$("#food-trucks").html("");
$("#weather").html("");

backBayBoston.resetLocation();
aquariumBoston.resetLocation();
kenmoreBoston.resetLocation();
eastBoston.resetLocation();
southStationBoston.resetLocation();
northeasternBoston.resetLocation();
copleyBoston.resetLocation();
}



function openDisplay(location) {
  $("#search-screen").hide();
  $("#display-screen").show();
  $("#display-header").text("Near " + location.name);
  findFoodTrucks(location);
  findWeather(location);
}

$("#back-bay-boston").on("click", function() {
  openDisplay(backBayBoston);
});

$("#aquarium-boston").on("click", function() {
  openDisplay(aquariumBoston);
});

$("#kenmore-boston").on("click", function() {
  openDisplay(kenmoreBoston);
});

$("#east-boston").on("click", function() {
  openDisplay(eastBoston);
});

$("#south-station-boston").on("click", function() {
  openDisplay(southStationBoston);
});

$("#copley-boston").on("click", function() {
  openDisplay(copleyBoston);
});

$("#northeastern-boston").on("click", function() {
  openDisplay(northeasternBoston);
});

$("#back-button").on("click", function(){
  reset();
});

//when page loads, we only want the search screen to show
$("#display-screen").hide();